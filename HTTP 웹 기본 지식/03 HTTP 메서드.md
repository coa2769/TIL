# HTTP API를 만들어보자

```
URI에서 가장 중요한 것은 리소스 이다.
```

URL을 설계할 때 리소스 등록, 수정, 조회는 모두 배제하고  리소스만 식별할 수 있도록 한다.

URI 계층 구조를 활용하여 구현

ex)

```
- 회원 목록 조회  /members
- 회원 조회      /members/{id}
- 회원 등록      /members/{id}
- 회원 수정      /members/{id}
- 회원 삭제      /members/{id}
```

리소스 만으로는 조회, 등록, 수정, 삭제를 구분할 수 없다.

이때 사용되는 것이 HTTP Method이다.



- URI는 리소스만 식별
- 리소스는 명사, 행위는 동사
- 행위는 HTTP Method로 구분한다.



# HTTP 메서드 - GET, POST



[ GET ]

- 리소스 조회



[ POST ]

- 메시지 바디를 통해 서버로 요청 데이터를 전달하여 이를 처리해달라고 한다.
- 요청 데이터를 어떻게 처리하는가?
  - 데이터 추가만을 뜻하지 않는다.
    - 새 리소스 생성
    - 요청 데이터 처리
      - 프로세스를 처리해아하는 경우
      - ex) 주문에 결제 완료 -> 배달시작 -> 배달완료 와 같은
    - 다른 메서드로 처리하기 애매한 경우
      - ex) JSON으로 조회 데이터를 넘겨야 햐는데 , GET 메서드를 사용하기 어려운 경우.
  - 이는 예제를 보고 이해하는 것이 더 쉽다.
  - 리소스 URI에 POST 요청이 오면 요청 데이터를 어떻게 처리할지 리소스마다 따로 정해야한다. 

- URI를 리소스만 표현하고 HTTP method로 동작을 표현하는 데 한계가 있을 때 우리는 컨트롤 URI를 사용한다.
  - ex) POST /orders/{orderId}/start-delivery 
    - 이렇게 끝에 동작을 추가함



# HTTP 메서드 - PUT, PATCH, DELETE

[PUT]

- 리소스를 대체 
  - 리소스가 있으면 대체, 없으면 생성
  - 덮어쓰기
  - 그러므로 기존의 수정되지 않는 것들도 같이 보내야 한다.
- 클라이언트가 리소스를 식별(중요!)

!! 덮어쓰기 되는 과정 중요!! 정리하기



[PATCH]

- 리소스 부분 변경
- 추후에 새로 생기 Method

!! 수정 되는 과정 중요!! 정리하기

- PATCH가 지원하지 않는 서버도 있다 그럴때는 POST를 쓴다.

[DELETE]

- 리소스 제거



# HTTP 메서드의 속성

## 안전(Safe)

- 호출해도 리소스를 변경하지 않는다.
- GET이외에는 모든 메서드는 변경이 이뤄지므로 안전하지 않다.
- 서버의 장애에 대한 내용이 아니라 해당 리소스가 변경되는가?에만 초점을 맞췄다.

## 멱등(Idempotent)

- 여러번 호출해도 결과가 똑같아야 한다. (여기서 중요한 것은 요청에 대한 최종 결과물이 같은가? 이다.)
- PUT은 내가 보낸 데이터로 덮어쓰기 하기 때문에 최종 결과물은 같으므로 멱등이다.
  - 이는 DELETE도 같다.
- POST는 두번 호출하면 새로운 리소스가 두번 생성되거나 중복 결제가 일어나므로 멱등하지 않다.

- 자동 복구 메커니즘에 활용된다.
- 멱등은 외부 요인으로 중간에 리소스가 변경되는 것 까지 고려하지 않는다!!!
  - 내가 똑같은 리소스를 여러번 요청했을 때에 최종 결과가 같은지만 생각한다.

## 캐시가능(Cacheable)

- GET, HEAD, POST, PATCH 는 스펙상으로는 캐시가 가능하다.
- 실제로는 GET, HEAD 정도만 캐싱한다.
  - 다른 Method는 본문 내용까지 캐시 키로 고려해야 하기 때문에 구현이 쉽지 않다.







